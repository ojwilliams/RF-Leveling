<!DOCTYPE html>
<html>
<head>
    <title>Receiver Settings</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <h2>Receiver Settings</h2>
    <form action="/settings" method="post">
        <div class="row">
            {% for key, receiver in receivers.items() %}
            <div class="col">
                <div class="form-group">
                    <label for="{{ key }}_ip">Receiver {{ key }} Full IP Address:</label>
                    <input type="text" class="form-control" id="{{ key }}_ip" name="{{ key }}_ip" value="{{ receiver.url.split('//')[1].split('/')[0] }}">

                    <h5>Graph Settings:</h5>
                    <p>Lets add some colours to our graph. Choose a MER DB value for the colour to change.</p>
                    <div id="graph-settings-{{ key }}">
                        {% for i in range(1, 4) %}
                        <div class="form-row align-items-center">
                            <div class="col-auto">
                                <label for="{{ key }}_threshold_{{ i }}">MER DB Threshold {{ i }}:</label>
                                <input type="number" class="form-control mb-2" id="{{ key }}_threshold_{{ i }}" name="{{ key }}_threshold_{{ i }}" placeholder="Value">
                            </div>
                            <div class="col-auto">
                                <label for="{{ key }}_color_{{ i }}">Color:</label>
                                <input type="color" class="form-control form-control-color mb-2" id="{{ key }}_color_{{ i }}" name="{{ key }}_color_{{ i }}">
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addSetting('{{ key }}')">Add Setting</button>

                    <div class="form-check mb-3">
                        <input type="checkbox" class="form-check-input" id="{{ key }}_update" name="{{ key }}_update" value="yes">
                        <label class="form-check-label" for="{{ key }}_update">Update this receiver</label>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <button type="submit" class="btn btn-primary">Update Selected</button>
    </form>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>

<script>
    function addSetting(receiverKey) {
        let settingsContainer = document.getElementById('graph-settings-' + receiverKey);
        let currentSettings = settingsContainer.getElementsByClassName('form-row').length;

        if (currentSettings < 5) {
            let settingNumber = currentSettings + 1;
            let newSettingHtml = `
                <div class="form-row align-items-center">
                    <div class="col-auto">
                        <label for="${receiverKey}_threshold_${settingNumber}">Threshold ${settingNumber}:</label>
                        <input type="number" class="form-control mb-2" id="${receiverKey}_threshold_${settingNumber}" name="${receiverKey}_threshold_${settingNumber}" placeholder="Value">
                    </div>
                    <div class="col-auto">
                        <label for="${receiverKey}_color_${settingNumber}">Color:</label>
                        <input type="color" class="form-control form-control-color mb-2" id="${receiverKey}_color_${settingNumber}" name="${receiverKey}_color_${settingNumber}">
                    </div>
                </div>`;

            settingsContainer.innerHTML += newSettingHtml;
        } else {
            alert('Maximum of 5 settings reached.');
        }
    }
</script>
</body>
</html>
